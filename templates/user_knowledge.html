{% extends "base.html" %}
{% block title %}Knowledge Base{% endblock %}

{% block content %}
<div class="user-shell">

  <!-- User Sidebar -->
  <aside class="user-sidebar">
    <div class="user-brand">Ops Platform</div>

    <nav class="user-nav">
      <a href="{{ url_for('dashboard.user_dashboard') }}">Dashboard</a>
      <a href="#">My Requests</a>
      <a href="#">Notifications</a>
      <a href="{{ url_for('dashboard.user_profile') }}">Profile</a>
      <a class="{{ 'active' if active_page == 'knowledge_base' else '' }}" href="{{ url_for('dashboard.user_knowledge_base') }}">Knowledge Base</a>
      <a href="#">Settings</a>

      <form method="POST" action="{{ url_for('auth.logout') }}">
        <button type="submit" class="btn user-logout">Logout</button>
      </form>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="user-content">

    <!-- Header Card -->
    <div class="card">
      <h2 style="margin-top:0;">Knowledge Base</h2>
      <div class="muted">Find answers and guides for common requests</div>
    </div>

    <!-- Search Bar -->
    <div class="card" style="margin-top:16px;">
      <div class="kb-search-container">
        <input 
          type="text" 
          class="kb-search-input" 
          placeholder="Search articles, guides, and FAQs..."
          id="kb-search"
        >
        <svg class="kb-search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
      </div>
    </div>

    <!-- Category Cards -->
    <div class="card" style="margin-top:16px;">
      <h3 style="margin-top:0; margin-bottom:16px;">Browse by Category</h3>
      
      <div class="kb-category-grid">
        {% for category in categories %}
        <div class="kb-category-card">
          <div class="kb-category-icon">
            {% if category == 'Access' %}
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
            {% elif category == 'Hardware' %}
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                <line x1="8" y1="21" x2="16" y2="21"></line>
                <line x1="12" y1="17" x2="12" y2="21"></line>
              </svg>
            {% elif category == 'Software' %}
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="16 18 22 12 16 6"></polyline>
                <polyline points="8 6 2 12 8 18"></polyline>
              </svg>
            {% elif category == 'Account Management' %}
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            {% elif category == 'Onboarding' %}
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <polyline points="17 11 19 13 23 9"></polyline>
              </svg>
            {% elif category == 'Offboarding' %}
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="23" y1="11" x2="17" y2="11"></line>
              </svg>
            {% elif category == 'Facilities' %}
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
              </svg>
            {% elif category == 'Security' %}
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
              </svg>
            {% endif %}
          </div>
          <div class="kb-category-name">{{ category }}</div>
          <div class="kb-category-count muted">Coming soon</div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Popular Articles -->
<div class="card" style="margin-top:16px;">
  <h3 style="margin-top:0; margin-bottom:16px;">Popular Articles</h3>
  
  <div class="kb-articles-list">
    
    <!-- VPN Access Article - NOW CLICKABLE -->
    <a href="{{ url_for('dashboard.kb_article_detail', slug='how-to-request-vpn-access') }}" 
       class="kb-article-item kb-article-link">
      <div class="kb-article-icon">üìÑ</div>
      <div class="kb-article-content">
        <div class="kb-article-title">How to Request VPN Access</div>
        <div class="muted" style="font-size:13px;">
          Step-by-step guide for requesting remote access credentials
        </div>
      </div>
      <div class="kb-article-meta">
        <span class="badge pending">Access</span>
      </div>
    </a>

    <!-- Hardware Article -->
    <a href="#" class="kb-article-item kb-article-link">
      <div class="kb-article-icon">üíª</div>
      <div class="kb-article-content">
        <div class="kb-article-title">Hardware Request Guidelines</div>
        <div class="muted" style="font-size:13px;">
          What to include when requesting laptops, monitors, or peripherals
        </div>
      </div>
      <div class="kb-article-meta">
        <span class="badge" style="background:#fef3c7;color:#92400e;">Hardware</span>
      </div>
    </a>

    <!-- Security Article -->
    <a href="#" class="kb-article-item kb-article-link">
      <div class="kb-article-icon">üîê</div>
      <div class="kb-article-content">
        <div class="kb-article-title">Password Reset Process</div>
        <div class="muted" style="font-size:13px;">
          How to reset your password and update security settings
        </div>
      </div>
      <div class="kb-article-meta">
        <span class="badge" style="background:#fee2e2;color:#991b1b;">Security</span>
      </div>
    </a>

    <!-- Software Article -->
    <a href="#" class="kb-article-item kb-article-link">
      <div class="kb-article-icon">üì¶</div>
      <div class="kb-article-content">
        <div class="kb-article-title">Software License Requests</div>
        <div class="muted" style="font-size:13px;">
          Requesting licenses for approved software and tools
        </div>
      </div>
      <div class="kb-article-meta">
        <span class="badge" style="background:#e0e7ff;color:#3730a3;">Software</span>
      </div>
    </a>

    <!-- Onboarding Article -->
    <a href="#" class="kb-article-item kb-article-link">
      <div class="kb-article-icon">üë§</div>
      <div class="kb-article-content">
        <div class="kb-article-title">New Employee Onboarding Checklist</div>
        <div class="muted" style="font-size:13px;">
          Essential steps for new team members during their first week
        </div>
      </div>
      <div class="kb-article-meta">
        <span class="badge approved">Onboarding</span>
      </div>
    </a>

  </div>
</div>


        <div class="kb-article-item">
          <div class="kb-article-icon">üíª</div>
          <div class="kb-article-content">
            <div class="kb-article-title">Hardware Request Guidelines</div>
            <div class="muted" style="font-size:13px;">What to include when requesting laptops, monitors, or peripherals</div>
          </div>
          <div class="kb-article-meta">
            <span class="badge" style="background:#fef3c7;color:#92400e;">Hardware</span>
          </div>
        </div>

        <div class="kb-article-item">
          <div class="kb-article-icon">üîê</div>
          <div class="kb-article-content">
            <div class="kb-article-title">Password Reset Process</div>
            <div class="muted" style="font-size:13px;">How to reset your password and update security settings</div>
          </div>
          <div class="kb-article-meta">
            <span class="badge" style="background:#fee2e2;color:#991b1b;">Security</span>
          </div>
        </div>

        <div class="kb-article-item">
          <div class="kb-article-icon">üì¶</div>
          <div class="kb-article-content">
            <div class="kb-article-title">Software License Requests</div>
            <div class="muted" style="font-size:13px;">Requesting licenses for approved software and tools</div>
          </div>
          <div class="kb-article-meta">
            <span class="badge" style="background:#e0e7ff;color:#3730a3;">Software</span>
          </div>
        </div>

        <div class="kb-article-item">
          <div class="kb-article-icon">üë§</div>
          <div class="kb-article-content">
            <div class="kb-article-title">New Employee Onboarding Checklist</div>
            <div class="muted" style="font-size:13px;">Essential steps for new team members during their first week</div>
          </div>
          <div class="kb-article-meta">
            <span class="badge approved">Onboarding</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Need Help Card -->
    <div class="card" style="margin-top:16px;">
      <div class="kb-help-section">
        <div class="kb-help-icon">üí¨</div>
        <div class="kb-help-content">
          <h3 style="margin:0 0 8px 0;">Can't Find What You're Looking For?</h3>
          <p class="muted" style="margin:0 0 16px 0;">
            Our team is here to help. Submit a request and we'll get back to you as soon as possible.
          </p>
          <a href="{{ url_for('dashboard.user_dashboard') }}" class="btn" style="display:inline-block;text-decoration:none;">
            Submit a Request
          </a>
        </div>
      </div>
    </div>

  </main>

</div>

<style>
/* Knowledge Base Styles */

/* Search Bar */
.kb-search-container {
  position: relative;
  width: 100%;
}

.kb-search-input {
  width: 100%;
  padding: 14px 16px 14px 48px;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  font-size: 15px;
  transition: border-color 0.2s;
}

.kb-search-input:focus {
  outline: none;
  border-color: #3b82f6;
}

.kb-search-icon {
  position: absolute;
  left: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: #9ca3af;
}

/* Category Grid */
.kb-category-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 12px;
}

.kb-category-card {
  background: #fafafa;
  padding: 20px;
  border-radius: 8px;
  border: 1px solid #eef2f7;
  text-align: center;
  transition: all 0.2s;
}

.kb-category-card:hover {
  background: #f5f5f5;
  border-color: #d1d5db;
  transform: translateY(-2px);
}

.kb-category-icon {
  width: 48px;
  height: 48px;
  margin: 0 auto 12px auto;
  background: #ffffff;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #3b82f6;
}

.kb-category-name {
  font-size: 14px;
  font-weight: 600;
  color: #111827;
  margin-bottom: 4px;
}

.kb-category-count {
  font-size: 12px;
}

/* Articles List */
.kb-articles-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.kb-article-item {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 16px;
  background: #fafafa;
  border-radius: 8px;
  border: 1px solid #eef2f7;
  transition: all 0.2s;
}

.kb-article-item:hover {
  background: #f5f5f5;
  border-color: #d1d5db;
  cursor: pointer;
}

.kb-article-icon {
  font-size: 24px;
  flex-shrink: 0;
}

.kb-article-content {
  flex: 1;
}

.kb-article-title {
  font-size: 15px;
  font-weight: 600;
  color: #111827;
  margin-bottom: 4px;
}

.kb-article-meta {
  flex-shrink: 0;
}

/* Help Section */
.kb-help-section {
  display: flex;
  align-items: center;
  gap: 20px;
  padding: 8px 0;
}

.kb-help-icon {
  font-size: 48px;
  flex-shrink: 0;
}

.kb-help-content {
  flex: 1;
}

/* Responsive */
@media (max-width: 768px) {
  .kb-category-grid {
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  }
  
  .kb-help-section {
    flex-direction: column;
    text-align: center;
  }
}
</style>

<script>
// Simple search functionality (filters articles by title/description)
document.getElementById('kb-search').addEventListener('input', function(e) {
  const searchTerm = e.target.value.toLowerCase();
  const articles = document.querySelectorAll('.kb-article-item');
  
  articles.forEach(article => {
    const title = article.querySelector('.kb-article-title').textContent.toLowerCase();
    const description = article.querySelector('.muted').textContent.toLowerCase();
    
    if (title.includes(searchTerm) || description.includes(searchTerm)) {
      article.style.display = 'flex';
    } else {
      article.style.display = 'none';
    }
  });
});
</script>

{% endblock %}
{% extends "base.html" %}
{% block title %}My Profile{% endblock %}

{% block content %}
<div class="user-shell">

  <!-- User Sidebar -->
  {% include 'partials/user_sidebar.html' %}

  <!-- Main Content -->
  <main class="user-content">

    <!-- Profile Header Card -->
    <div class="card profile-header-card">
      <div class="profile-header-content">
        <div class="profile-avatar">
          {% if user.avatar_url %}
            <img src="{{ user.avatar_url }}" alt="{{ user.full_name or user.email }}" class="avatar-image">
          {% else %}
            <span class="avatar-initials">
              {% if user.full_name %}
                {{ user.full_name.split()[0][0] }}{{ user.full_name.split()[1][0] if user.full_name.split()|length > 1 else user.full_name.split()[0][1] }}
              {% else %}
                {{ user.email[0:2].upper() }}
              {% endif %}
            </span>
          {% endif %}
        </div>
        <div class="profile-header-info">
          <h2 class="profile-name">{{ user.full_name or user.email }}</h2>
          <div class="profile-meta">
            <span class="badge role-badge {{ 'admin-badge' if user.role == 'admin' else 'user-badge' }}">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
              </svg>
              {{ user.role | capitalize }}
            </span>
            {% if user.created_at %}
            <span class="profile-joined">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              Member since {{ user.created_at.split()[0] if user.created_at else 'N/A' }}
            </span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Account Information Card -->
    <div class="card" style="margin-top:20px;">
    <div class="card-header-row">
      <h3 style="margin:0;">Account Information</h3>
    <a href="{{ url_for('dashboard.edit_profile') }}"
      class="action-button action-button-secondary"
      style="padding:6px 12px; font-size:14px;">
     Edit Profile
  </a>
</div>
     
      <div class="profile-grid">
        <div class="profile-field">
          <label class="profile-label">
            <svg class="field-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            Full Name
          </label>
          <div class="profile-value">{{ user.full_name or 'Not set' }}</div>
        </div>

        <div class="profile-field">
          <label class="profile-label">
            <svg class="field-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
              <polyline points="22,6 12,13 2,6"></polyline>
            </svg>
            Email Address
          </label>
          <div class="profile-value">{{ user.email }}</div>
        </div>

        <div class="profile-field">
          <label class="profile-label">
            <svg class="field-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
            </svg>
            Role
          </label>
          <div class="profile-value">
            <span class="badge {{ 'admin-badge' if user.role == 'admin' else 'user-badge' }}">
              {{ user.role | capitalize }}
            </span>
          </div>
        </div>

        <div class="profile-field">
          <label class="profile-label">
            <svg class="field-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            Department
          </label>
          <div class="profile-value">{{ user.department or 'Not assigned' }}</div>
        </div>
      </div>
    </div>

    <!-- Request Statistics Card -->
    <div class="card" style="margin-top:20px;">
      <h3 style="margin-top:0; margin-bottom:24px;">Request Activity</h3>
      
      <div class="stats-grid">
        <!-- Total Requests -->
        <div class="stat-box">
          <div class="stat-icon-wrapper stat-icon-blue">
            <svg class="stat-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ stats.total_requests or 0 }}</div>
            <div class="stat-label">Total Requests</div>
          </div>
        </div>

        <!-- Avg Completion Time -->
        <div class="stat-box">
          <div class="stat-icon-wrapper stat-icon-purple">
            <svg class="stat-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-number">
              {% if stats.avg_completion_days %}
                {{ stats.avg_completion_days }}
              {% else %}
                --
              {% endif %}
            </div>
            <div class="stat-label">
              {% if stats.avg_completion_days %}
                Avg. Completion (days)
              {% else %}
                Avg. Completion Time
              {% endif %}
            </div>
            {% if not stats.avg_completion_days and stats.total_requests == 0 %}
              <div class="stat-hint">No completed requests yet</div>
            {% endif %}
          </div>
        </div>

        <!-- SLA Met % -->
        <div class="stat-box">
          <div class="stat-icon-wrapper stat-icon-green">
            <svg class="stat-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ stats.sla_met_percent }}%</div>
            <div class="stat-label">SLA Met</div>
            {% if stats.total_requests == 0 %}
              <div class="stat-hint">No requests tracked</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions Card -->
    <div class="card" style="margin-top:20px;">
      <h3 style="margin-top:0; margin-bottom:16px;">Quick Actions</h3>
      <div class="quick-actions-grid">
        <a href="{{ url_for('dashboard.user_requests') }}" class="action-button action-button-primary">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
          </svg>
          View All My Requests
        </a>
        <a href="{{ url_for('dashboard.user_knowledge_base') }}" class="action-button action-button-secondary">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
          </svg>
          Browse Knowledge Base
        </a>
        <a href="{{ url_for('dashboard.user_preferences') }}" class="action-button action-button-secondary">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M12 1v6m0 6v6m8.66-12L17.6 9.6M6.4 14.4l-3.06 3.06M23 12h-6m-6 0H1m20.66 8.66l-3.06-3.06M6.4 9.6L3.34 6.54"></path>
          </svg>
          Update Settings
        </a>
      </div>
    </div>

  </main>

</div>

<style>
/* ===================================
   PROFILE PAGE STYLES
   =================================== */

/* Profile Header Card */
.profile-header-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  padding: 32px;
}

.profile-header-content {
  display: flex;
  align-items: center;
  gap: 24px;
}

.profile-avatar {
  flex-shrink: 0;
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  border: 3px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.avatar-image {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  object-fit: cover;
}

.avatar-initials {
  font-size: 32px;
  font-weight: 700;
  color: white;
  text-transform: uppercase;
}

.profile-header-info {
  flex: 1;
}

.profile-name {
  margin: 0 0 12px 0;
  font-size: 28px;
  font-weight: 700;
  color: white;
  letter-spacing: -0.025em;
}

.profile-meta {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
}

.profile-joined {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 14px;
  color: rgba(255, 255, 255, 0.9);
  font-weight: 500;
}

.profile-joined svg {
  opacity: 0.8;
}

.role-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

/* Account Information Grid */
.profile-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 24px;
}

.profile-field {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.profile-label {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  font-weight: 700;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.field-icon {
  opacity: 0.7;
}

.profile-value {
  font-size: 15px;
  color: #111827;
  font-weight: 500;
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
}

.stat-box {
  background: #f8fafc;
  padding: 24px;
  border-radius: 12px;
  border: 1px solid #e2e8f0;
  display: flex;
  align-items: flex-start;
  gap: 16px;
  transition: all 0.2s ease;
}

.stat-box:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.stat-icon-wrapper {
  flex-shrink: 0;
  width: 48px;
  height: 48px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.stat-icon-blue {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
}

.stat-icon-purple {
  background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
}

.stat-icon-green {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
}

.stat-icon {
  color: white;
}

.stat-content {
  flex: 1;
}

.stat-number {
  font-size: 32px;
  font-weight: 700;
  color: #111827;
  line-height: 1;
  margin-bottom: 6px;
}

.stat-label {
  font-size: 12px;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-weight: 600;
}

.stat-hint {
  font-size: 11px;
  color: #9ca3af;
  margin-top: 4px;
  font-style: italic;
}

/* Badge variations */
.admin-badge {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  color: #fff;
  border: 1px solid rgba(245, 158, 11, 0.3);
}

.user-badge {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: #fff;
  border: 1px solid rgba(59, 130, 246, 0.3);
}

/* Quick Actions */
.quick-actions-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
}

.action-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 14px 24px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 14px;
  text-decoration: none;
  transition: all 0.2s ease;
  border: 1px solid transparent;
}

.action-button-primary {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: white;
  box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
}

.action-button-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
}

.action-button-secondary {
  background: white;
  color: #374151;
  border: 1px solid #e5e7eb;
}

.action-button-secondary:hover {
  background: #f9fafb;
  border-color: #d1d5db;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
}

/* ===================================
   DARK MODE PROFILE STYLES
   =================================== */

body.dark .profile-header-card {
  background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
}

body.dark .profile-label {
  color: #94a3b8;
}

body.dark .profile-value {
  color: #f1f5f9;
}

body.dark .stat-box {
  background: #1e293b;
  border-color: #334155;
}

body.dark .stat-box:hover {
  background: #283548;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

body.dark .stat-number {
  color: #f8fafc;
}

body.dark .stat-label {
  color: #94a3b8;
}

body.dark .stat-hint {
  color: #64748b;
}

body.dark .action-button-primary {
  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
  box-shadow: 0 2px 8px rgba(37, 99, 235, 0.4);
}

body.dark .action-button-primary:hover {
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.5);
}

body.dark .action-button-secondary {
  background: #1e293b;
  color: #f1f5f9;
  border-color: #334155;
}

body.dark .action-button-secondary:hover {
  background: #283548;
  border-color: #475569;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

body.dark .admin-badge {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  color: #fff;
  border: 1px solid rgba(245, 158, 11, 0.5);
}

body.dark .user-badge {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: #fff;
  border: 1px solid rgba(59, 130, 246, 0.5);
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .profile-header-content {
    flex-direction: column;
    text-align: center;
  }

  .profile-meta {
    justify-content: center;
  }

  .profile-grid,
  .stats-grid,
  .quick-actions-grid {
    grid-template-columns: 1fr;
  }

  .profile-name {
    font-size: 24px;
  }

  .stat-number {
    font-size: 28px;
  }
}

/* Force consistent padding in both modes to allow natural scrolling */
.card {
  padding: 24px;
}

.profile-header-card {
  padding: 32px;
}

body.dark .card {
  padding: 24px;
}

body.dark .profile-header-card {
  padding: 32px;
}
</style>

{% endblock %}
{% extends "base.html" %}
{% block title %}My Requests{% endblock %}

{% block content %}

<div class="user-shell">
  <!-- User Sidebar -->
  {% include 'partials/user_sidebar.html' %}

  <!-- Main Content -->
  <main class="user-content my-requests-page">
    <div class="dashboard-container">
      <!-- Header -->
      <div class="requests-page-header">
        <div>
          <h1>My Requests</h1>
          <p class="subtitle">Track and manage all your submitted requests</p>
        </div>
        <button class="new-request-btn-header" onclick="openNewRequestModal()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          New Request
        </button>
      </div>

      <!-- Filter & Search Bar -->
      <div class="requests-controls">
        <div class="search-wrapper">
          <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16zM18 18l-4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <input type="text" id="requests-search" class="search-input" placeholder="Search by type, category, or ID...">
        </div>

        <div class="filter-group">
          <select id="filter-status" class="filter-select">
            <option value="">All Statuses</option>
            <option value="pending">Pending</option>
            <option value="in_progress">In Progress</option>
            <option value="approved">Approved</option>
            <option value="denied">Denied</option>
            <option value="completed">Completed</option>
          </select>

          <select id="filter-priority" class="filter-select">
            <option value="">All Priorities</option>
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
          </select>

          <select id="filter-category" class="filter-select">
            <option value="">All Categories</option>
            <option value="Access">Access</option>
            <option value="Hardware">Hardware</option>
            <option value="Software">Software</option>
            <option value="Account Management">Account Management</option>
            <option value="Onboarding">Onboarding</option>
            <option value="Offboarding">Offboarding</option>
            <option value="Facilities">Facilities</option>
            <option value="Security">Security</option>
          </select>
        </div>
      </div>

      <!-- Requests Grid -->
      <div id="requests-container" class="requests-grid">
        <!-- Loading state -->
        <div class="loading-state">
          <div class="spinner"></div>
          <p>Loading your requests...</p>
        </div>
      </div>

      <!-- Empty State (hidden by default) -->
      <div id="empty-state" class="empty-state" style="display: none;">
        <svg class="empty-icon" width="120" height="120" viewBox="0 0 120 120" fill="none">
          <circle cx="60" cy="60" r="50" stroke="#e5e7eb" stroke-width="2" stroke-dasharray="4 4"/>
          <path d="M60 40v40M40 60h40" stroke="#d1d5db" stroke-width="3" stroke-linecap="round"/>
        </svg>
        <h2>No requests yet</h2>
        <p>Get started by submitting your first request</p>
        <button class="new-request-btn-empty" onclick="openNewRequestModal()">
          Create Request
        </button>
      </div>
    </div>
  </main>
</div>

<!-- Request Detail Modal -->
<div class="modal-overlay" id="requestDetailModal">
  <div class="modal-content modal-detail">
    <div class="modal-header">
      <div>
        <h2 id="detail-request-type">Request Details</h2>
        <p class="request-id-label">ID: <span id="detail-request-id"></span></p>
      </div>
      <button class="modal-close" onclick="closeDetailModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <div class="detail-grid">
        <div class="detail-section">
          <h3>Overview</h3>
          <div class="detail-row">
            <span class="detail-label">Category</span>
            <span id="detail-category" class="detail-value"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Department</span>
            <span id="detail-department" class="detail-value"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Status</span>
            <span id="detail-status" class="detail-value"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Priority</span>
            <span id="detail-priority" class="detail-value"></span>
          </div>
        </div>

        <div class="detail-section">
          <h3>Timeline</h3>
          <div class="detail-row">
            <span class="detail-label">Submitted</span>
            <span id="detail-created" class="detail-value"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Reviewed</span>
            <span id="detail-reviewed" class="detail-value"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">SLA Status</span>
            <span id="detail-sla" class="detail-value"></span>
          </div>
        </div>
      </div>

      <div id="review-notes-section" class="detail-section full-width" style="display: none;">
        <h3>Admin Review Notes</h3>
        <div class="review-notes-box">
          <p id="detail-review-notes"></p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- New Request Modal -->
<div class="modal-overlay" id="newRequestModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Submit a New Request</h2>
      <button class="modal-close" onclick="closeNewRequestModal()">&times;</button>
    </div>
    
    <form method="POST" action="{{ url_for('requests.create_request') }}" class="modal-form">
      <div class="field">
        <label for="request_type">Request Type</label>
        <input
          id="request_type"
          class="input"
          name="request_type"
          placeholder="e.g. VPN Access"
          required
        >
      </div>

      <div class="field">
        <label for="category">Category</label>
        <select id="category" class="input" name="category" required>
          <option value="">Select category</option>
          <option value="Access">Access</option>
          <option value="Hardware">Hardware</option>
          <option value="Software">Software</option>
          <option value="Account Management">Account Management</option>
          <option value="Onboarding">Onboarding</option>
          <option value="Offboarding">Offboarding</option>
          <option value="Facilities">Facilities</option>
          <option value="Security">Security</option>
        </select>
      </div>

      <div class="field">
        <label for="priority">Priority</label>
        <select id="priority" class="input" name="priority" required>
          <option value="">Select priority</option>
          <option value="low">Low</option>
          <option value="medium">Medium</option>
          <option value="high">High</option>
        </select>
      </div>

      <div class="btn-group">
        <button type="button" class="btn btn-secondary" onclick="closeNewRequestModal()">Cancel</button>
        <button type="submit" class="btn btn-primary">Submit Request</button>
      </div>
    </form>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/user_requests.js') }}"></script>
{% endblock %}
